<!-- 
RSS generated by JIRA (5.2.8#851-sha1:3262fdc28b4bc8b23784e13eadc26a22399f5d88) at Mon Jun 03 15:14:37 UTC 2013

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LUCENE-4877/LUCENE-4877.xml?field=key&field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>5.2.8</version>
        <build-number>851</build-number>
        <build-date>26-02-2013</build-date>
    </build-info>

<item>
            <title>[LUCENE-4877] Fix analyzer factories to throw exception when arguments are invalid</title>
                <link>https://issues.apache.org/jira/browse/LUCENE-4877</link>
                <project id="12310110" key="LUCENE">Lucene - Core</project>
                        <description>&lt;p&gt;Currently if someone typos an argument &quot;someParamater=xyz&quot; instead of someParameter=xyz, they get no exception and sometimes incorrect behavior.&lt;/p&gt;

&lt;p&gt;It would be way better if these factories threw exception on unknown params, e.g. they removed the args they used and checked they were empty at the end.&lt;/p&gt;</description>
                <environment></environment>
            <key id="12638770">LUCENE-4877</key>
            <summary>Fix analyzer factories to throw exception when arguments are invalid</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                    <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png">Closed</status>
                    <resolution id="1">Fixed</resolution>
                                <assignee username="-1">Unassigned</assignee>
                                <reporter username="rcmuir">Robert Muir</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Mar 2013 01:07:12 +0000</created>
                <updated>Tue, 14 May 2013 23:13:48 +0100</updated>
                    <resolved>Sat, 6 Apr 2013 12:27:34 +0100</resolved>
                                            <fixVersion>5.0</fixVersion>
                <fixVersion>4.3</fixVersion>
                                <component>modules/analysis</component>
                        <due></due>
                    <votes>0</votes>
                        <watches>2</watches>
                                                    <comments>
                    <comment id="13612344" author="rcmuir" created="Mon, 25 Mar 2013 01:09:01 +0000"  >&lt;p&gt;here&apos;s one way we could improve it. There are probably other alternatives that might be better, too.&lt;/p&gt;

&lt;p&gt;I only fixed one factory as its better to decide this before going thru all of them.&lt;/p&gt;</comment>
                    <comment id="13612412" author="steve_rowe" created="Mon, 25 Mar 2013 06:02:12 +0000"  >&lt;p&gt;+1, patch looks good.&lt;/p&gt;</comment>
                    <comment id="13617472" author="jpountz" created="Fri, 29 Mar 2013 16:14:39 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="13617961" author="rcmuir" created="Sat, 30 Mar 2013 02:38:40 +0000"  >&lt;p&gt;Thanks guys. I&apos;ve begun the &quot;horrible slave work&quot; part &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Hope to have a patch soon.&lt;/p&gt;</comment>
                    <comment id="13618178" author="rcmuir" created="Sat, 30 Mar 2013 22:49:03 +0000"  >&lt;p&gt;I have fixed all the factories, but currently I just started fixing tests and adding tests for bogus parameters to all factories.&lt;/p&gt;

&lt;p&gt;I added some helpers to BaseTokenStreamTestCase and fixed TestArabicFilters.java as a prototype...&lt;/p&gt;

&lt;p&gt;slow moving&lt;/p&gt;</comment>
                    <comment id="13618246" author="rcmuir" created="Sun, 31 Mar 2013 06:17:26 +0100"  >&lt;p&gt;updated patch: tests in analysis/common are done. I&apos;ll look at the other analysis modules and solr tomorrow.&lt;/p&gt;</comment>
                    <comment id="13618477" author="mikemccand" created="Sun, 31 Mar 2013 22:39:22 +0100"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                    <comment id="13618662" author="rcmuir" created="Mon, 1 Apr 2013 07:59:30 +0100"  >&lt;p&gt;whew, made it thru the rest. all tests pass.&lt;/p&gt;</comment>
                    <comment id="13618720" author="steve_rowe" created="Mon, 1 Apr 2013 11:09:25 +0100"  >&lt;p&gt;Really nice de-cluttering in the tests.&lt;/p&gt;

&lt;p&gt;I don&apos;t like the 4-arg required param getXXX() methods in AbstractAnalysisFactory - 4th param as false means required??? - maybe these could be converted to getRequiredXXX() ?&lt;/p&gt;

&lt;p&gt;I think AbstractAnalysisFactory could use additional param parsing methods:&lt;/p&gt;

&lt;ul&gt;
    &lt;li&gt;get(args, param &lt;span class=&quot;error&quot;&gt;&amp;#91;, default&amp;#93;&lt;/span&gt;) would be a nice addition for strings, instead of args.remove(), which looks different from all the other getXXX() methods.  Maybe also a version that takes a set of acceptable values, as well as a boolean for case insensitivity?&lt;/li&gt;
    &lt;li&gt;getEnum(args, param, Enum class &lt;span class=&quot;error&quot;&gt;&amp;#91;, default&amp;#93;&lt;/span&gt; ) - probably case insensitivity could be assumed?&lt;/li&gt;
    &lt;li&gt;getChar() should be pulled out of PathHierarchyTokenizerFactory, so that DelimitedPayloadTokenFilterFactory can use it.&lt;/li&gt;
    &lt;li&gt;getFloat() - well, only one factory (NumericPayloadTokenFilterFactory) could use it now, but maybe add it for completeness?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A few nits:&lt;/p&gt;

&lt;ul&gt;
    &lt;li&gt;TestMappingCharFilterFactory&apos;s factory could switch to being instantiated using the charFilterFactory() method&lt;/li&gt;
    &lt;li&gt;EdgeNgramTokenizerFactory&apos;s gram size constants are pulled from EdgeNgramTokenFilter instead of EdgeNgramTokenizer&lt;/li&gt;
    &lt;li&gt;LimitTokenCountFilterFactory&apos;s maxTokenCount param should be required; this is a pre-existing problem though&lt;/li&gt;
    &lt;li&gt;PatternTokenizerFactory&apos;s group param should use the getInt() method with a default of -1.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I can do the work if you agree with these.&lt;/p&gt;</comment>
                    <comment id="13618722" author="thetaphi" created="Mon, 1 Apr 2013 11:15:53 +0100"  >&lt;p&gt;Should we create a branch. I also have some ideas to fix...&lt;/p&gt;</comment>
                    <comment id="13618731" author="rcmuir" created="Mon, 1 Apr 2013 11:36:17 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I don&apos;t like the 4-arg required param getXXX() methods in AbstractAnalysisFactory - 4th param as false means required??? - maybe these could be converted to getRequiredXXX() ?&lt;/p&gt;

&lt;p&gt;I think AbstractAnalysisFactory could use additional param parsing methods:&lt;/p&gt;

&lt;p&gt;    get(args, param &lt;span class=&quot;error&quot;&gt;&amp;#91;, default&amp;#93;&lt;/span&gt;) would be a nice addition for strings, instead of args.remove(), which looks different from all the other getXXX() methods. Maybe also a version that takes a set of acceptable values, as well as a boolean for case insensitivity?&lt;br/&gt;
    getEnum(args, param, Enum class &lt;span class=&quot;error&quot;&gt;&amp;#91;, default&amp;#93;&lt;/span&gt; ) - probably case insensitivity could be assumed?&lt;br/&gt;
    getChar() should be pulled out of PathHierarchyTokenizerFactory, so that DelimitedPayloadTokenFilterFactory can use it.&lt;br/&gt;
    getFloat() - well, only one factory (NumericPayloadTokenFilterFactory) could use it now, but maybe add it for completeness?&lt;/p&gt;

&lt;p&gt;A few nits:&lt;/p&gt;

&lt;p&gt;    TestMappingCharFilterFactory&apos;s factory could switch to being instantiated using the charFilterFactory() method&lt;br/&gt;
    EdgeNgramTokenizerFactory&apos;s gram size constants are pulled from EdgeNgramTokenFilter instead of EdgeNgramTokenizer&lt;br/&gt;
    LimitTokenCountFilterFactory&apos;s maxTokenCount param should be required; this is a pre-existing problem though&lt;br/&gt;
    PatternTokenizerFactory&apos;s group param should use the getInt() method with a default of -1.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;+1 to all of this!&lt;/p&gt;</comment>
                    <comment id="13618734" author="rcmuir" created="Mon, 1 Apr 2013 11:38:32 +0100"  >&lt;blockquote&gt;
&lt;p&gt;Should we create a branch. I also have some ideas to fix...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can, or maybe just use trunk? I don&apos;t think the patch makes these factories any worse.&lt;/p&gt;</comment>
                    <comment id="13618736" author="steve_rowe" created="Mon, 1 Apr 2013 11:41:12 +0100"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Should we create a branch. I also have some ideas to fix...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can, or maybe just use trunk? I don&apos;t think the patch makes these factories any worse.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to commit Robert&apos;s patch to trunk and iterate there.&lt;/p&gt;</comment>
                    <comment id="13618738" author="rcmuir" created="Mon, 1 Apr 2013 11:48:16 +0100"  >&lt;p&gt;Or you can assign the issue. I just have family coming into town today and won&apos;t have any time to do any of the work to help out with this one. &lt;/p&gt;

&lt;p&gt;I thought i knew what was involved with this stuff pretty well but I grossly underestimated the amount of work to even throw the exception &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;20&quot; width=&quot;20&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    <comment id="13618842" author="thetaphi" created="Mon, 1 Apr 2013 16:43:39 +0100"  >&lt;p&gt;I have no preference on how to proceed. I just dont want to download such a large patch, modify the sources and upload it again. especially as TortoiseSVN and other clients depend on order of files in filesystem, the order of created patches is different, too. So its impossible to see any change in comparison to earlier patches.&lt;/p&gt;

&lt;p&gt;As we don&apos;t intend to release trunk soon: If all tests pass, can you simply commit as a first step, Robert? +1 on the current patch. We can open further issues to unfuck ResourceLoaderAware (it should be removed, too and the ResourceLoader should be passed to the ctor, too).&lt;/p&gt;</comment>
                    <comment id="13618854" author="rcmuir" created="Mon, 1 Apr 2013 16:52:31 +0100"  >&lt;blockquote&gt;
&lt;p&gt;I have no preference on how to proceed. I just dont want to download such a large patch, modify the sources and upload it again. especially as TortoiseSVN and other clients depend on order of files in filesystem, the order of created patches is different, too. So its impossible to see any change in comparison to earlier patches.&lt;/p&gt;

&lt;p&gt;As we don&apos;t intend to release trunk soon: If all tests pass, can you simply commit as a first step, Robert? +1 on the current patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok. I&apos;ll commit this one to trunk. We can merge back to stable when we are happy.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;We can open further issues to unfuck ResourceLoaderAware (it should be removed, too and the ResourceLoader should be passed to the ctor, too).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t like this either: but it would require more heavy duty stuff in solr to fix that. I also think it would be good to separate that from the goal of throwing exceptions for bogus arguments (as i fixed that for all analysis factories in this patch despite the ResourceLoader issue: all arguments are parsed in ctor and the inform() only does actual loading).&lt;/p&gt;

&lt;p&gt;The challenge in fixing the ResourceLoader stuff is in SolrResourceLoader. when it loads these &quot;aware&quot; classes it only adds them to a list (it defers this), and then at the end calls inform() on everything in the list. I haven&apos;t looked into why this is, but yeah i would definitely prefer if this was a followup issue actually.&lt;/p&gt;

&lt;p&gt;I would like this change (throw exception on invalid arguments) to make it back to the stable branch, so I&apos;ll keep this issue open until everyone is happy with it. But in general we should try to split up issues for these factories into steps: its not easy to make these sweeping changes unless you either have lots of time or are ok with introducing bugs.&lt;/p&gt;</comment>
                    <comment id="13618881" author="rcmuir" created="Mon, 1 Apr 2013 17:30:13 +0100"  >&lt;p&gt;I committed this to trunk. Can we be extra careful to use &lt;a href=&quot;https://issues.apache.org/jira/browse/LUCENE-4877&quot; title=&quot;Fix analyzer factories to throw exception when arguments are invalid&quot;&gt;&lt;del&gt;LUCENE-4877&lt;/del&gt;&lt;/a&gt;: in all commit messages so when its time to backport its easy to find the revisions?&lt;/p&gt;

&lt;p&gt;Thanks in advance for any improvements!&lt;/p&gt;</comment>
                    <comment id="13618885" author="rcmuir" created="Mon, 1 Apr 2013 17:32:38 +0100"  >&lt;blockquote&gt;
&lt;p&gt;getFloat() - well, only one factory (NumericPayloadTokenFilterFactory) could use it now, but maybe add it for completeness?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I just remembered. I think the reversewildcardfactory in solr has one of these too. &lt;/p&gt;</comment>
                    <comment id="13618993" author="steve_rowe" created="Mon, 1 Apr 2013 19:12:19 +0100"  >&lt;p&gt;Patch fixing these minor nits:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;TestMappingCharFilterFactory&apos;s factory could switch to being instantiated using the charFilterFactory() method&lt;br/&gt;
EdgeNgramTokenizerFactory&apos;s gram size constants are pulled from EdgeNgramTokenFilter instead of EdgeNgramTokenizer&lt;br/&gt;
LimitTokenCountFilterFactory&apos;s maxTokenCount param should be required; this is a pre-existing problem though&lt;br/&gt;
PatternTokenizerFactory&apos;s group param should use the getInt() method with a default of -1.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, I was wrong about LimitTokenCountFilterFactory - it already has a test in place to insure reporting of missing required maxTokenCount param.&lt;/p&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                    <comment id="13618996" author="rcmuir" created="Mon, 1 Apr 2013 19:14:35 +0100"  >&lt;p&gt;Thanks Steve!&lt;/p&gt;</comment>
                    <comment id="13619336" author="steve_rowe" created="Tue, 2 Apr 2013 00:44:50 +0100"  >&lt;p&gt;This patch adds more param parsing methods to AbstractAnalysisFactory, including get(), require(), getFloat(), getChar(), and getSet(), and changed all analysis factories to use them where appropriate.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I don&apos;t like the 4-arg required param getXXX() methods in AbstractAnalysisFactory - 4th param as false means required??? - maybe these could be converted to getRequiredXXX() ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I implemented these as require(), requireXXX(), etc.&lt;/p&gt;

&lt;p&gt;Tests all pass, and precommit&apos;s happy.&lt;/p&gt;

&lt;p&gt;Committing shortly.&lt;/p&gt;</comment>
                    <comment id="13622206" author="rcmuir" created="Thu, 4 Apr 2013 14:44:56 +0100"  >&lt;p&gt;Thanks for cleaning this up Steve, much nicer.&lt;/p&gt;

&lt;p&gt;I&apos;d like to merge these commits back to 4.x if there are no objections.&lt;/p&gt;</comment>
                    <comment id="13653730" author="thetaphi" created="Fri, 10 May 2013 11:32:48 +0100"  >&lt;p&gt;Closed after release.&lt;/p&gt;</comment>
                </comments>
                <issuelinks>
                        <issuelinktype id="12310050">
                <name>Regression</name>
                                <outwardlinks description="breaks">
                            <issuelink>
            <issuekey id="12647241">SOLR-4813</issuekey>
        </issuelink>
                    </outwardlinks>
                                            </issuelinktype>
                    </issuelinks>
                <attachments>
                    <attachment id="12575267" name="LUCENE-4877_one_solution_prototype.patch" size="13185" author="rcmuir" created="Mon, 25 Mar 2013 01:09:01 +0000" />
                    <attachment id="12576346" name="LUCENE-4877.patch" size="582792" author="rcmuir" created="Mon, 1 Apr 2013 07:59:30 +0100" />
                    <attachment id="12576268" name="LUCENE-4877.patch" size="505019" author="rcmuir" created="Sun, 31 Mar 2013 06:17:26 +0100" />
                    <attachment id="12576255" name="LUCENE-4877.patch" size="251726" author="rcmuir" created="Sat, 30 Mar 2013 22:49:03 +0000" />
                    <attachment id="12576409" name="LUCENE-4877-steve-minor-fixes.patch" size="2801" author="steve_rowe" created="Mon, 1 Apr 2013 19:12:19 +0100" />
                    <attachment id="12576462" name="LUCENE-4877-steve-more-param-parsing-verbs.patch" size="69257" author="steve_rowe" created="Tue, 2 Apr 2013 00:44:50 +0100" />
                </attachments>
            <subtasks>
        </subtasks>
                <customfields>
                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                <customfieldname>Attachment count</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>6.0</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                <customfieldname>Date of First Response</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>Mon, 25 Mar 2013 06:02:12 +0000</customfieldvalue>

                </customfieldvalues>
            </customfield>
                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Global Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>319250</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310120" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                <customfieldname>Lucene Fields</customfieldname>
                <customfieldvalues>
                        <customfieldvalue key="10121"><![CDATA[New]]></customfieldvalue>
    
                </customfieldvalues>
            </customfield>
                                            <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                <customfieldname>Rank</customfieldname>
                <customfieldvalues>
                    <customfieldvalue>319231</customfieldvalue>
                </customfieldvalues>
            </customfield>
                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                <customfieldname>Time in Status</customfieldname>
                <customfieldvalues>
                    
                </customfieldvalues>
            </customfield>
                            </customfields>
    </item>
</channel>
</rss>